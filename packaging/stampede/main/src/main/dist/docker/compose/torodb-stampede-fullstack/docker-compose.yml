version: '2'
services:
  torodb-stampede:
    image: 8kdata/torodb-stampede
    links:
      - postgres
      - mongodb
    environment:
      - TORODB_SETUP=true
      - MONGO_SYNC_SOURCE=mongodb:27017
      - POSTGRES_PASSWORD
      - TORODB_BACKEND_HOST=postgres
      - TORODB_BACKEND_PORT=5432
      - TORODB_BACKEND_DATABASE
      - TORODB_BACKEND_USER
      - TORODB_BACKEND_PASSWORD
      - DEBUG
  postgres:
    image: postgres:9.6
    environment:
      - POSTGRES_PASSWORD
    ports:
      - "15432:5432"
  mongodb:
    image: mongo:3.2
    ports:
      - "28017:27017"
    volumes:
      - ../target/dist/docker:/util
    entrypoint:
      - /bin/bash
      - /util/initiate-mongo-rs
